/* niui  – Form */
@import "../../css/niui-setup";

.n-form {
  padding: var(--nui-line-height-em) 0;

  * {
    box-sizing: border-box;
  }

  label,
  input,
  textarea {
    display: inline-block;
    vertical-align: middle;
  }

  --nui-placeholder-color: #aaa;

  ::-webkit-input-placeholder {
    color: var(--nui-placeholder-color);
    -webkit-text-fill-color: var(--nui-placeholder-color);
  }

  input[type="submit"],
  button[type="submit"],
  label,
  &__check span,
  label > span {
    line-height: var(--nui-line-height);
    min-height: var(--nui-line-height-em);
  }

  label {
    font-weight: bold;
    max-width: 100%;
    position: relative;
    padding: 0;
    margin: 0 0 var(--nui-line-height-em) 0;
    min-height: calc(var(--nui-line-height-em) * 2);
  }

  input[type="submit"],
  button,
  button[type="submit"] {
    height: auto;
    line-height: var(--nui-line-height);
    white-space: normal;
    word-break: break-all;
    margin: 0;
    max-width: 100%;
    padding: 0 1em;
    font-weight: 500;
  }

  input,
  select,
  textarea,
  input[type="search"],
  button,
  .n-form__file span {
    font-family: inherit;
    display: inline-block;
    overflow: hidden;
    resize: none;
    vertical-align: top;
    border-radius: 0;
    padding: 0 calc(var(--nui-line-height-em) / 2);
    min-height: calc(var(--nui-line-height-em) * 2);
    border: 0;
    font-size: 1em;
    // border: 1px dotted transparent;
    border-radius: var(--nui-border-radius);
    box-shadow: 0 0 0 var(--nui-border-size) var(--nui-border-color), 0 0 var(--nui-shadow-blur) calc(var(--nui-border-size) + var(--nui-shadow-size)) var(--nui-shadow-color);
  }

  input[type="checkbox"] {
    border-radius: 0;
  }

  .n-form__file span span {
    display: flex;
    align-items: center;
  }

  textarea {
    border-bottom: 1px dotted transparent;
    height: 0;
    min-height: calc(var(--nui-line-height-em) * 3);
    padding-top: calc(var(--nui-line-height-em) / 2);
    margin: var(--nui-line-height-em) 0;

    &:not([data-auto]) {
      overflow: auto;
    }

    &[data-auto] {
      transform: translate3d(0, 0, 0); // Fix for disappearing textarea after deleting its overflowed text
    }
  }

  input,
  textarea {
    background-color: var(--nui-input-bg, #eee);
    color: var(--nui-input-color, #333);
  }

  select {
    -moz-appearance: none;
    -webkit-appearance: none;
    appearance: none;
    text-indent: 0.01px;
    min-height: 0;
    text-indent: 0px;
    padding: 0 1.6em 0 0.8em;
    height: calc(var(--nui-line-height-em) * 2);
    white-space: nowrap;
    text-indent: -1px;
    margin: 0;
    text-indent: 1px;
    cursor: pointer;
    background: linear-gradient(to bottom left, transparent 30%, var(--nui-control-color, #333) 10%, var(--nui-control-color, #333) 50%, transparent 30%),
      linear-gradient(to bottom right, transparent 30%, var(--nui-control-color, #333) 10%, var(--nui-control-color, #333) 50%, transparent 30%);
    background-size: 0.4em 0.4em;
    background-repeat: no-repeat;
    background-position: calc(100% - 0.85em), calc(100% - 0.5em);
    color: var(--nui-control-color, #333);
    background-color: var(--nui-control-bg, #eee);

    option {
      padding: 0;
      padding-inline-end: 1.5em;
    }
  }

  select,
  &__file {
    vertical-align: top;
    border: none;
    margin-inline-start: 0;
  }

  input[type="search"] {
    -webkit-appearance: none; // Prevent iOS from rounding the input edges
    border-radius: 0;

    &::-webkit-search-decoration,
    &::-webkit-search-cancel-button {
      -webkit-appearance: none;
    }
  }

  label,
  label span,
  &__check span {
    margin: 0;
    text-align: start;
  }

  input,
  select {
    display: inline-block;
    width: auto;
    padding-top: 0;
    margin: var(--nui-line-height-em) 0;
    vertical-align: middle;
  }

  &.sticky-submit {
    position: relative;

    input[type="submit"],
    button[type="submit"] {
      position: absolute;
      top: 0;
      bottom: 0;
      inset-inline-end: 0;
    }
  }

  &__check,
  & fieldset {
    display: block;
    min-height: var(--nui-line-height-em);
    margin-bottom: var(--nui-line-height-em);
    border-radius: var(--nui-border-radius);

    span {
      display: inline-block;
      font-weight: bold;
      margin-top: 0;
      cursor: default;
    }

    label {
      text-align: start;
      font-weight: normal;
      clear: right;
      margin: 0;
      cursor: pointer;
      min-height: 0;
      user-select: none;
      padding-inline-start: 0;
      padding-inline-end: 0.75em;
      padding-bottom: 0;
      display: inline;

      span {
        width: auto;
      }

      &:last-child {
        margin-bottom: 0;
      }

      input[type="checkbox"],
      input[type="radio"] {
        margin: -0.25em 0.2em 0 0;
      }
    }
  }

  &__check-icon {
    width: 1em;
    height: 1em;
    display: inline-block;
    background-color: var(--nui-control-bg, #eee);
    color: var(--nui-control-color, #333);
    line-height: calc((var(--nui-line-height) + 1) * (2 / 3));
    // font-size: calc((var(--nui-line-height) - 2) * (2em/3));
    text-align: center;
    border: none;
    margin: 0;
    position: absolute;
    inset-inline-start: 0;
    z-index: 1;
    top: 0.05em;
    vertical-align: middle;
  }

  &--mast,
  &--wide {
    .n-form__check-icon {
      top: 0.25em;
    }
  }

  input[type="checkbox"] + .n-form__check-icon:before {
    content: "✓";
    display: block;
    height: 1em;
    line-height: 1;
  }

  input[type="checkbox"]:not(:checked) + .n-form__check-icon:before {
    opacity: 0;
  }

  input[type="checkbox"],
  input[type="radio"] {
    -webkit-appearance: none;
    -moz-appearance: window;
    -ms-appearance: none;
    background: transparent;
    cursor: pointer;
    padding: 0;
    min-height: 0;
    height: 1em;
    width: 1em;
    display: inline-block;
    margin: 0;
    border: none;
  }

  input[type="radio"] + .n-form__check-icon {
    border-radius: 50%;
  }

  input[type="radio"]:checked + .n-form__check-icon:before {
    content: "";
    position: absolute;
    background-color: var(--nui-control-color, #333);
    top: 25%;
    right: 25%;
    bottom: 25%;
    left: 25%;
    border-radius: 50%;
  }

  &--mandatory {
    position: relative;

    fieldset:before,
    span.n-form__check:before,
    span.tip:after {
      display: none;
    }

    &:before {
      content: "*";
      color: #a00;
      position: absolute;
      top: 0;
      font-weight: bold;
      inset-inline-start: auto;
      inset-inline-end: 0;
    }

    &:has(fieldset):before {
      top: -0.25rem;
    }
  }

  &--alert {

    span,
    p {
      background: #666;
      color: #eee;
      padding: 0 0.25em;
    }

    span.n-form__check,
    fieldset {
      background: none;
      color: #555;
    }

    span.tip {
      background: #222;
    }
  }

  &__file {
    font-weight: normal;
    margin: 0 0 var(--nui-line-height) 0;
    cursor: pointer;
    font-style: italic;
    padding: 0;
    position: relative;
    z-index: 0;

    span {
      text-align: start;
      border: none;
      white-space: nowrap;
      background-color: var(--nui-control-bg, #ddd);
      color: var(--nui-control-color, inherit);
      padding: 0 calc(var(--nui-line-height-em) / 2) 0 0.75em;
      display: block;
      line-height: var(--nui-line-height-em);
      padding-top: calc(var(--nui-line-height-em) / 2);
      letter-spacing: 0;
      position: absolute;
      inset: 0;
      z-index: -1;

      .n-form__file-name {

        &:empty,
        &:not(:empty) ~ .n-form__file-tag {
          display: none;
        }
      }

    }

    input[type="file"] {
      width: 100%;
      cursor: pointer;
      border: none;
      margin: 0;
      background: transparent;
      color: transparent;
      text-indent: -100%;
      padding: 0;
      opacity: 0; // Hide iPad thumbnail, because it appears in a random position

      &:focus + span {
        outline: auto;
      }
    }
  }

  input[type="range"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 100%;
    background: none;
    margin: 0;
    padding: 0;
    box-shadow: none;

    &::-webkit-slider-runnable-track {
      width: 100%;
      height: 0.7125em;
      cursor: pointer;
      background: var(--nui-control-bg, rgba(0, 0, 0, 0.1));
    }

    &::-webkit-slider-thumb {
      height: 1.625em;
      width: 1.625em;
      border-radius: 50%;
      background: var(--nui-control-highlight, #000);
      cursor: pointer;
      -webkit-appearance: none;
      margin-top: -0.45625em;
    }

    &:focus::-webkit-slider-runnable-track {
      background: var(--nui-control-bg, rgba(0, 0, 0, 0.1));
    }

    &::-moz-range-track {
      width: 100%;
      height: 0.7125em;
      cursor: pointer;
      background: var(--nui-control-bg, rgba(0, 0, 0, 0.1));
    }

    &::-moz-range-thumb {
      border: 0px solid rgba(0, 0, 0, 0);
      height: 1.625em;
      width: 1.625em;
      border-radius: 50%;
      background: var(--nui-control-bg, rgba(0, 0, 0, 0.1));
      cursor: pointer;
    }
  }

  legend {
    font-weight: bold;
  }

  fieldset {
    border: 1px solid;
    display: block;
    margin: var(--nui-line-height-em) 0;
    padding: calc(var(--nui-line-height-em) / 2 - 0.5px);

    input:last-of-type {
      // margin-bottom: calc(var(--nui-line-height-em)/3);
    }

    &[disabled] {
      display: none;
    }
  }

  input[type="submit"],
  button {
    width: auto;
    min-width: 0;
    padding: 0 1em;
    min-height: calc(var(--nui-line-height-em) * 1.6667);
    text-align: start;
    font-size: 1.2em;
    border-radius: var(--nui-border-radius);
  }

  &--wide textarea,
  &--mast textarea {
    margin: calc(var(--nui-line-height-em) / -2) 0 calc(var(--nui-line-height-em) / 2) 0;
  }

  &--wide {

    input[type="submit"],
    button,
    button[type="submit"] {
      margin-bottom: calc(var(--nui-line-height-em) - 5px);
      line-height: calc((var(--nui-line-height-em) / 3) * 2);
      font-size: 1.2em;
      min-height: 2.50005em;
      width: 100%;
    }

    select {
      width: 100%;
      height: calc(var(--nui-line-height-em) * 2);
      margin: calc(var(--nui-line-height-em) / -2) 0 calc(var(--nui-line-height-em) / 2) 0;
    }

    label,
    label span,
    .n-form__check span,
    fieldset label,
    label,
    .n-form__file {
      display: block;
      width: 100%;
      clear: both;
    }

    &:not(.sticky-submit) input:not([type="checkbox"]):not([type="radio"]),
    textarea,
    select {
      display: block;
      width: 100%;
      border: none;
      margin: 0 0 var(--nui-line-height-em) 0;
    }

    &:not(.sticky-submit) fieldset > {

      input:not([type="checkbox"]):not([type="radio"]),
      textarea,
      select {
        &:last-of-type {
          margin: 0;
        }
      }
    }

    .n-form__check,
    fieldset {
      label {

        input[type="checkbox"],
        input[type="radio"] {
          margin-top: -0.2em;
        }
      }
    }
  }

  &.n-form--mast {

    input[type="submit"],
    button,
    button[type="submit"] {
      margin-inline-start: calc(50% + 0.5em);
      margin-bottom: calc(var(--nui-line-height-em) * 1.5);
    }
    
    input[type="text"] {
      height: 0; // Overheight on narrow screens
    }

    label,
    fieldset {
      width: 100%;
      display: grid;
      grid-template: auto/1fr 1fr;
      column-gap: 1em;
      margin-bottom: 1.5em;
    }

    fieldset {
      border-color: transparent;
      border: none;
      padding: calc(var(--nui-line-height-em) / 2);
      padding-top: 0;
      padding-bottom: var(--nui-line-height-em);

      legend {
        margin-bottom: calc(-1 * var(--nui-line-height-em));
        text-align: end;
        grid-column: 1/2;
        grid-row: 1/2;
        width: 50%;
      }

      label {
        margin: 0;
        display: block;
      }
    }

    > label > *,
    > .n-form__check > *,
    > .n-form__check fieldset > *,
    fieldset > * {
      // width: 50%;
      width: 100%;
      // float: right;
      // clear: right;
      margin: calc(var(--nui-line-height-em) / -2) 0 calc(var(--nui-line-height-em) * 1.5) 0;
      grid-column: -2/-1;
    }

    > label > span,
    > .n-form__check > span,
    > .n-form__check fieldset > span {
      text-align: end;
      grid-column: 1;
      margin: 0;
    }

    > .n-form__check {
      display: grid;
      grid-template: auto/1fr 1fr;
      column-gap: 1em;

      > * {
        margin: 0;
      }

      label {
        display: block;
        // margin-inline-start: .5em;
      }

      fieldset {
        display: contents;

        // 				label {
        //
        // 					input[type="checkbox"],
        // 					input[type="radio"] {
        // 						margin-bottom: -0.125em;
        // 					}
        // 				}

        legend,
        label {
          margin: 0;
        }

        legend {
          grid-column: 1;
        }
      }
    }

    // 		fieldset {
    // 			label {
    //
    // 				input[type="checkbox"],
    // 				input[type="radio"] {
    // 					margin-bottom: -0.125em;
    // 				}
    // 			}
    // 		}

    .n-form--mandatory:before {
      inset-inline-start: calc(50% - 0.5em);
      z-index: -1;
    }
  }

  //   &--language {
  //     select {
  //       height: auto;
  //       width: 100%;
  //       margin-inline-start: 0;
  //       height: calc(var(--nui-line-height-em) * 2);
  //       line-height: calc(var(--nui-line-height-em) * 2);
  //       margin: 0;
  //     }
  //
  //     input[type="submit"] {
  //       min-height: 1em;
  //       padding: 0 0.5em;
  //     }
  //   }
}

// Safari 16.4 fieldset/legend/grid bug
_::-webkit-full-page-media,
_:future,
:root .n-form.n-form--mast fieldset {
  display: block;
  grid-column: 1/3;
}

_::-webkit-full-page-media,
_:future,
:root .n-form.n-form--mast fieldset legend {
  width: calc(50% - .5em);
  float: inline-start;
  margin: 0;
}

_::-webkit-full-page-media,
_:future,
:root .n-form.n-form--mast fieldset label {
  width: calc(50% - .5em);
  float: inline-end;
}
